卷积神经网络

> Coursera 专项课程 Deep Learning Specialization （由 DeepLearning.AI 提供）的第 4 课 Convolutional Neural Networks 的学习笔记

# 卷积神经网络基础

## 计算机视觉

### 边缘检测

星号 * 是卷积的标志

卷积的计算

![](https://img.jxtxzzw.com/2020/10/19/qwzykq.png)

用小的图片会使得边缘看起来很粗，用大的图片就会很好

正边缘、负边缘

其他的过滤器

Sobel： 更加稳定

![](https://img.jxtxzzw.com/2020/10/19/qxc88c.png)

Scharr：

![](https://img.jxtxzzw.com/2020/10/19/qxesym.png)

### 填充

使用过滤器的缺陷：

1. 对一个 $$n \times n$$ 的矩阵应用一个 $$f \times f$$ 的过滤器，得到的图片是 $$(n - f + 1) \times (n - f + 1)$$ 的维度

2. 角落和边际上的像素只会被使用一次，所以会丢失靠近边界的信息

改进：使用填充（padding）

+ Valid 卷积: 没有填充；

+ Same 卷积: 填充若干个像素使得输出图像的大小与原始输入图像的大小相同，即对一个 $$n \times n$$ 的矩阵应用一个 $$f \times f$$ 的过滤器，为了得到的图片是 $$n \times n$$ 的维度，需要填充 $$p = \frac{f - 1}{2}$$ 个像素，因为 $$n + 2 \times p - f + 1 = n$$。在实践中，$$f$$ 始终是奇数，这可以避免上述 $$p$$ 出现不对称的填充，同时 $$f \times f$$ 将有一个中心像素可以描述过滤器的位置；

+ Strided 卷积：每次移动的步长为 $$S$$，对一个 $$n \times n$$ 的矩阵应用一个 $$f \times f$$ 的过滤器，得到的图片是 $$(\frac{n + 2 \times p- f}{S} + 1) \times (\frac{n + 2 \times p- f}{S} + 1)$$ 的维度，其中 $$p$$ 是填充像素个数、$$S$$ 是步长，商 $$\frac{n + 2 \times p- f}{2}$$ 向下取整。

### Pooling Layers

Max Pooling 的每个输出值将会是其对应颜色区域的最大值

![](https://img.jxtxzzw.com/2020/10/19/qxgvh7.png)

![](https://img.jxtxzzw.com/2020/10/19/qxj5rr.png)

与之对应的，Average Pooling 就是取平均

![](https://img.jxtxzzw.com/2020/10/19/qxl5dc.png)

# 案例学习

## 经典神经网络

+ LeNet-5 在灰度图像上训练，通常是 $32 \times 32 \times 1$

  ![](https://img.jxtxzzw.com/2020/11/18/10sufq6.png)

+ AlexNet，通常是 $227 \times 227 \times 3$

  ![](https://img.jxtxzzw.com/2020/11/18/10szia4.png)

+ VGG-16

  ![](https://img.jxtxzzw.com/2020/11/18/10xqm5x.png)

## 残差神经网络

ResNet 适合训练非常非常深的神经网络

太深的神经网络训练起来很难，因为有梯度消失和爆炸这类问题 

跳跃连接（skip connection）能从一层中得到激活，并突然把它递给下一层，甚至更深的神经网络层，利用它，就可以训练网络层很深很深的残差网络

![](https://img.jxtxzzw.com/2020/11/18/112dhod.png)

$a[l]$ 经过 Linear、ReLU（得到 $a[l+1]$，并经过）Linear、ReLu，得到 $a[l+2]$ 的主路径，也可以经由 $a[l]$ 经过一个捷径直接得到 $a[l+2]$

大量堆积这样的残差块，就可以训练很深的神经网络

![](https://img.jxtxzzw.com/2020/11/18/111cd8l.png)

图中每 2 个块之间建立了跳跃连接，形成一个残差块，图中是 5 个残差块组成的残差神经网络

## 使用卷积神经网络的实用性建议

使用开源实现

迁移学习

数据增强（随机裁剪、镜像、旋转、色彩变换）

# 物体检测

## 单物体检测

首先用卷积神经网络训练一个 $n \times n$ 的图片，判断图像是否是汽车，输出 0 或者 1

然后用滑动窗口来完成物体检测，从图像的左上角到右下角，每次移动 $n \times n$ 的滑动窗口，判断这个窗口中的图像是不是汽车，依次移动，并增大窗口的边长

## 多物体检测

多目标检测时，用向量 $y=[p_c,b_x,b_y,b_h,b_w,c_1,c_2,c_3]$ 表示，其中 $p_c$ 表示是否包含目标，如果为 $0$，则不关心其他维度的数据，即，$[1,?,?,?,?,?,?,?]$，如果为 $1$，则 $(b_x, b_y)$ 位置的一个长宽为 $b_h \times b_w$ 的方框中，有目标分类 $c_x$，$c_x$ 表示是什么分类

## 其他

将全连接层转化为卷积层可以加速这个训练过程

YOLO 算法可以更精确地划分边界，例如识别长方形的车辆，原理是即便一个图像横跨多个方框，也只把它算在其中心点包含的方框中——You Only Look Once

当 2 个方框重叠时，其 IoU 值为两个方框的交集大小除以并集大小

多目标检测时，$p_c$ 表示有目标的概率，将小于阈值的边界框全部丢弃，对于剩余的边界框，选取最大 $p_c$ 作为预输出的边界框，这些边界框中如果有重叠，根据 IoU 决定是都保留、还是抛弃一个，将 IoU 大于阈值的全部丢弃

锚点框可以标记同一个网格中的多个对象


# 人脸识别

人脸识别的难点在于

+ 单样本训练，准确度难以保证
+ 可能会有员工加入或者离职，不应该频繁重新训练模型

所以在人脸识别时，模型只涉及相似性函数 D：给定两张图片，要输出两张图片的差异程度

在实际使用中，将当前照片依次与数据库中的人脸比对，用 D 计算得到结果，以最小的那个差异度作为识别结果

这样，当有员工变动时，只需要更新数据库中的员工照片，并仍然使用之前学习得到的相似度函数 D 即可



我们希望 Anchor 和 Positive 之间的距离小于 Anchor 和 Negative 之间的距离

所以 $||f(A) - f(P) || ^2 - ||f(A) - f(N) || ^2 \leqslant 0$

为了确保不会一直输出 0，我们需要确保这个式子远小于 0，利用超参数 $\alpha$（叫做 margin）

 $ ||f(A) - f(P) || ^2 - ||f(A) - f(N) || ^2 \leqslant -\alpha$



# 风格迁移

![](https://img.jxtxzzw.com/2021/01/05/x5zkd1.png)







